<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HRBRP | Training Assist</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <script>
        const CONFIG = {
            WEBHOOK_ANN: "https://discord.com/api/webhooks/1464977885629779990/D-mwGVTC23B7dsnZ70p5TFyV1mvLACJLKVmF9xJtsd2Othgg7VzwzMwOCFU8Wd_v6rni",
            WEBHOOK_RES: "https://discord.com/api/webhooks/1464977885629779990/D-mwGVTC23B7dsnZ70p5TFyV1mvLACJLKVmF9xJtsd2Othgg7VzwzMwOCFU8Wd_v6rni",
            WEBHOOK_DQ: "https://discord.com/api/webhooks/1464977885629779990/D-mwGVTC23B7dsnZ70p5TFyV1mvLACJLKVmF9xJtsd2Othgg7VzwzMwOCFU8Wd_v6rni", 
            ANNOUNCE_ROLE_ID: "1452651642850775082",
            ACCESS_KEY: "Mersenoob",
            LOGO_THUMB: "https://cdn.discordapp.com/attachments/1434075893868920852/1453697701366730802/hrbrp.png",
            IMG_ANN: "https://cdn.discordapp.com/attachments/1434075893868920852/1453697838994296855/HRPBRP_Announcement.png",
            IMG_RES: "https://cdn.discordapp.com/attachments/1434075893868920852/1453697757872394321/HRBRP___TER.png",
            IMG_VV: "https://cdn.discordapp.com/attachments/1434075893868920852/1453697795138523268/HRBRP_VV_Results.png"
        };
    </script>
    <style>
        :root {
            --bg: #05070a; --panel: rgba(16, 20, 35, 0.95);
            --pink: #ff00ff; --blue: #00f2ff; --gold: #ffcc00;
            --pass: #00ff88; --fail: #ff4444; --text: #ffffff;
            --okay: #d6d31b;
        }
        body { font-family: 'Inter', sans-serif; background: radial-gradient(circle at top right, #1a0b2e, #05070a); color: var(--text); margin: 0; display: flex; flex-direction: column; align-items: center; min-height: 100vh; }
        #login-screen { background: var(--panel); padding: 50px; border: 2px solid var(--pink); border-radius: 20px; text-align: center; margin-top: 100px; }
        #dashboard { display: none; width: 95%; max-width: 1100px; background: var(--panel); backdrop-filter: blur(15px); border-radius: 24px; border: 1px solid rgba(255, 255, 255, 0.1); margin: 20px 0; }
        .tabs { display: flex; background: rgba(0,0,0,0.4); }
        .tab { flex: 1; padding: 20px; text-align: center; cursor: pointer; color: #666; font-weight: 800; text-transform: uppercase; }
        .tab.active { color: var(--blue); border-bottom: 3px solid var(--blue); background: rgba(0, 242, 255, 0.05); }
        .content { padding: 40px; display: none; }
        .content.active { display: block; }
        label { display: block; margin-top: 15px; color: var(--blue); font-size: 0.75rem; font-weight: 800; text-transform: uppercase; }
        input, textarea, select { background: rgba(0,0,0,0.4); border: 1px solid var(--blue); color: white; padding: 12px; width: 100%; border-radius: 8px; margin-top: 5px; box-sizing: border-box; }
        .eval-section { border: 1px solid rgba(255,255,255,0.1); padding: 15px; border-radius: 12px; margin-top: 20px; background: rgba(255,255,255,0.02); }
        .eval-section h4 { margin-top: 0; color: var(--gold); border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 5px; }
        .toggle-row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 10px; }
        .t-btn { padding: 8px; cursor: pointer; border: 1px solid rgba(255,255,255,0.1); background: rgba(255,255,255,0.05); color: white; border-radius: 6px; font-weight: bold; font-size: 0.7rem; flex: 1; transition: 0.2s; }
        .t-btn.active-green { background: var(--pass); color: #000; }
        .t-btn.active-red { background: var(--fail); color: #fff; }
        .t-btn.active-okay { background: var(--okay) !important; color: #000 !important; border-color: var(--okay) !important; }
        .btn-grp { display: flex; gap: 5px; margin-top: 5px; }
        .primary-btn { background: var(--blue); color: black; border: none; padding: 18px; width: 100%; border-radius: 12px; font-weight: 800; cursor: pointer; margin-top: 25px; text-transform: uppercase; }
        .conditional-box { background: rgba(255, 68, 68, 0.05); padding: 10px; border-left: 3px solid var(--fail); margin-top: 10px; display: none; }
        .batch-card { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.1); padding: 15px; border-radius: 12px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .section-note { height: 60px; font-size: 0.8rem; margin-top: 10px; border: 1px dashed rgba(0, 242, 255, 0.3); }
    </style>
</head>
<body>

    <div id="login-screen">
        <h1 style="color: var(--gold); font-weight: 800;">HRBRP | Training Assist</h1>
        <input type="password" id="pass-field" style="text-align:center" placeholder="ACCESS KEY">
        <button onclick="unlock()" class="primary-btn">INITIALIZE</button>
    </div>

    <div id="dashboard">
        <div class="tabs">
            <div class="tab active" id="tab-ann" onclick="switchTab('ann')">Announcements</div>
            <div class="tab" id="tab-res" onclick="switchTab('res')">Training Results</div>
            <div class="tab" id="tab-voice" onclick="switchTab('voice')">Voice Verification</div>
        </div>

        <div id="ann-content" class="content active">
            <h2>ANNOUNCEMENT SYSTEM</h2>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div><label>Trainer Discord ID</label><input type="text" id="ann-uid"></div>
                <div><label>Training Type</label><input type="text" id="ann-type" value="Normal Training"></div>
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div><label>Location</label><input type="text" id="ann-loc" value="Sheriff Briefing Room"></div>
                <div><label>Start Date & Time (Required)*</label><input type="datetime-local" id="ann-time" required></div>
            </div>
            <label>Description/Sections</label>
            <textarea id="ann-desc" rows="2">Knowledge Section, Mod Call Section and Driving Section. Tick if attending.</textarea>
            <button onclick="postAnn()" class="primary-btn">ANNOUNCE</button>
        </div>

        <div id="res-content" class="content">
            <h2>BATCH EVALUATOR</h2>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; background: rgba(0,0,0,0.3); padding: 20px; border-radius: 15px;">
                <div><label>Host Roblox</label><input type="text" id="h-rblx" oninput="saveHost()"></div>
                <div><label>Host Discord ID</label><input type="text" id="h-id" oninput="saveHost()"></div>
            </div>

            <div style="margin-top: 30px; padding: 25px; border: 1px solid var(--pink); border-radius: 20px;">
                <h3 style="color: var(--pink); margin-top: 0;">TRAINEE INPUT</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <input type="text" id="t-rblx" placeholder="Roblox Username">
                    <input type="text" id="t-id" placeholder="Discord User ID">
                </div>

                <div class="eval-section">
                    <h4>1. KNOWLEDGE SECTION (10 MARKS)</h4>
                    <div id="knowledge-container" style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;"></div>
                    <textarea id="note-know" class="section-note" placeholder="Knowledge Section Notes (Optional)"></textarea>
                </div>

                <div class="eval-section">
                    <h4>2. SCENE 1 - RDM (10 MARKS)</h4>
                    <div class="toggle-row">
                        <div><label>Healed?</label><div class="btn-grp"><button class="t-btn" onclick="setTog('s1_h', 2.5, this)">Yes</button><button class="t-btn" onclick="setTog('s1_h', 0, this)">No</button></div></div>
                        <div><label>SPaG?</label><div class="btn-grp"><button class="t-btn" onclick="setTog('s1_s', 2.5, this)">Yes</button><button class="t-btn" onclick="setTog('s1_s', 0, this)">No</button></div></div>
                        <div><label>Proof?</label><div class="btn-grp"><button class="t-btn" onclick="setTog('s1_p', 2.5, this)">Yes</button><button class="t-btn" onclick="setTog('s1_p', 0, this)">No</button></div></div>
                        <div><label>Member Disrespect?</label><div class="btn-grp"><button class="t-btn" onclick="setTog('s1_m', 2.5, this, 'staff')">Yes</button><button class="t-btn" onclick="setTog('s1_m', 0, this, 'staff')">No</button></div></div>
                    </div>
                    <div id="cond-staff" class="conditional-box"><label>Staff Disrespect?</label><div class="btn-grp"><button class="t-btn" onclick="setTog('s1_sd', 1.5, this, 'srdm')">Yes</button><button class="t-btn" onclick="setTog('s1_sd', 0, this, 'srdm')">No</button></div></div>
                    <div id="cond-srdm" class="conditional-box"><label>SRDM?</label><div class="btn-grp"><button class="t-btn" onclick="setTog('s1_sr', 0.5, this)">Yes</button><button class="t-btn" onclick="setTog('s1_sr', 0, this)">No</button></div></div>
                    <textarea id="note-s1" class="section-note" placeholder="Scene 1 Notes (Optional)"></textarea>
                </div>

                <div class="eval-section">
                    <h4>3. SCENE 2 - CUFF RUSH (10 MARKS)</h4>
                    <div class="toggle-row">
                        <div><label>SPaG?</label><div class="btn-grp"><button class="t-btn" onclick="setTog('s2_s', 2.5, this)">Yes</button><button class="t-btn" onclick="setTog('s2_s', 0, this)">No</button></div></div>
                        <div><label>Punished Properly?</label><div class="btn-grp"><button class="t-btn" onclick="setTog('s2_p', 2.5, this)">Yes</button><button class="t-btn" onclick="setTog('s2_p', 0, this)">No</button></div></div>
                    </div>
                    <label>Proof Guidance?</label>
                    <div class="btn-grp">
                        <button class="t-btn" onclick="setTog('s2_g', 5, this)">Yes</button>
                        <button class="t-btn" onclick="setMidTog('s2_g', 2.5, this)">Struggled</button>
                        <button class="t-btn" onclick="setTog('s2_g', 0, this)">No</button>
                    </div>
                    <textarea id="note-s2" class="section-note" placeholder="Scene 2 Notes (Optional)"></textarea>
                </div>

                <div class="eval-section">
                    <h4>4. DRIVING SECTION (10 MARKS)</h4>
                    <div class="toggle-row">
                        <div><label>Control?</label><div class="btn-grp"><button class="t-btn" onclick="setTog('d1', 2.5, this)">Yes</button><button class="t-btn" onclick="setTog('d1', 0, this)">No</button></div></div>
                        <div><label>Lights?</label><div class="btn-grp"><button class="t-btn" onclick="setTog('d2', 2.5, this)">Yes</button><button class="t-btn" onclick="setTog('d2', 0, this)">No</button></div></div>
                        <div><label>Speed?</label><div class="btn-grp"><button class="t-btn" onclick="setTog('d3', 2.5, this)">Yes</button><button class="t-btn" onclick="setTog('d3', 0, this)">No</button></div></div>
                        <div><label>Rules?</label><div class="btn-grp"><button class="t-btn" onclick="setTog('d4', 2.5, this)">Yes</button><button class="t-btn" onclick="setTog('d4', 0, this)">No</button></div></div>
                    </div>
                    <textarea id="note-drive" class="section-note" placeholder="Driving Section Notes (Optional)"></textarea>
                </div>

                <label>Overall Final Comments (Optional)</label>
                <textarea id="t-notes" placeholder="Final summary..."></textarea>
                
                <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 10px; margin-top: 20px;">
                    <button onclick="addTrainee()" class="primary-btn" style="background: var(--pass); margin-top: 0;">ADD BATCH</button>
                    <button onclick="dqTrainee()" class="primary-btn" style="background: var(--fail); color: white; margin-top: 0;">DQ</button>
                </div>
            </div>
            <div id="batch-list" style="margin-top: 20px;"></div>
            <button id="publish-btn" onclick="publish()" class="primary-btn" style="background: var(--pink); color: white; display: none;">PUBLISH ALL</button>
        </div>

        <div id="voice-content" class="content">
            <h2>VOICE VERIFICATION UNIT</h2>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div><label>Trainer ID</label><input type="text" id="v-trainer-uid"></div>
                <div><label>Trainee ID</label><input type="text" id="v-trainee-uid"></div>
            </div>
            <label>Username</label><input type="text" id="v-trainee-name">
            <label>Age Group</label>
            <select id="v-age"><option value="Under 13">Under 13</option><option value="13-15">13-15</option><option value="15-17">15-17</option><option value="18+">18+</option></select>
            <button onclick="postVoiceVerify()" class="primary-btn" style="background: var(--gold); color: black;">SUBMIT</button>
        </div>
    </div>

    <script>
        let batch = [];
        let scores = {};

        const kDiv = document.getElementById('knowledge-container');
        for(let i=1; i<=10; i++) {
            kDiv.innerHTML += `<div><label>Q${i}</label><div class="btn-grp"><button class="t-btn" onclick="setTog('k${i}',1,this)">Good</button><button class="t-btn" onclick="setMidTog('k${i}',0.5,this)">Okay</button><button class="t-btn" onclick="setTog('k${i}',0,this)">Bad</button></div></div>`;
        }

        function unlock() { if(document.getElementById('pass-field').value === CONFIG.ACCESS_KEY) { document.getElementById('login-screen').style.display='none'; document.getElementById('dashboard').style.display='block'; loadHost(); } else alert("DENIED"); }
        function saveHost() { localStorage.setItem('hr_host_rblx', document.getElementById('h-rblx').value); localStorage.setItem('hr_host_id', document.getElementById('h-id').value); }
        function loadHost() { document.getElementById('h-rblx').value = localStorage.getItem('hr_host_rblx') || ""; document.getElementById('h-id').value = localStorage.getItem('hr_host_id') || ""; }
        function switchTab(t) { document.querySelectorAll('.content').forEach(c=>c.classList.remove('active')); document.querySelectorAll('.tab').forEach(tab=>tab.classList.remove('active')); document.getElementById(t+'-content').classList.add('active'); document.getElementById('tab-'+t).classList.add('active'); }

        function setTog(key, val, btn, cond) {
            scores[key] = val;
            btn.parentElement.querySelectorAll('.t-btn').forEach(b => b.className = 't-btn');
            btn.className = val > 0 ? 't-btn active-green' : 't-btn active-red';
            if(cond === 'staff') document.getElementById('cond-staff').style.display = val === 0 ? 'block' : 'none';
            if(cond === 'srdm') document.getElementById('cond-srdm').style.display = val === 0 ? 'block' : 'none';
        }

        function setMidTog(key, val, btn) {
            scores[key] = val;
            btn.parentElement.querySelectorAll('.t-btn').forEach(b => b.className = 't-btn');
            btn.className = 't-btn active-okay';
        }

        function addTrainee() {
            const rblx = document.getElementById('t-rblx').value;
            const tid = document.getElementById('t-id').value;
            if(!rblx || !tid) return alert("Missing Info");
            let total = 0; Object.values(scores).forEach(v => total += v);

            // Store each note locally
            batch.push({ 
                rblx, id: tid, 
                score: total.toFixed(1), 
                status: total >= 21 ? "PASS" : "FAIL", 
                notes: {
                    knowledge: document.getElementById('note-know').value.trim(),
                    scene1: document.getElementById('note-s1').value.trim(),
                    scene2: document.getElementById('note-s2').value.trim(),
                    driving: document.getElementById('note-drive').value.trim(),
                    overall: document.getElementById('t-notes').value.trim()
                }
            });
            renderBatch(); clearForm();
        }

        async function dqTrainee() {
            const rblx = document.getElementById('t-rblx').value;
            const tid = document.getElementById('t-id').value;
            const hId = document.getElementById('h-id').value;
            if(!rblx || !tid) return alert("Enter Trainee details.");
            const reason = prompt("DQ Reason:");
            if(!reason) return;
            const body = { content: `<@${hId}> <@${tid}>`, embeds: [{ title: "DISQUALIFIED", color: 16711680, fields: [{name:"Trainee", value:rblx, inline:true}, {name:"Reason", value:reason}] }] };
            await fetch(CONFIG.WEBHOOK_DQ, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(body) });
            batch.push({ rblx, id: tid, score: "0", status: "DISQUALIFIED", notes: { overall: "DQ: " + reason } });
            renderBatch(); clearForm();
        }

        function renderBatch() {
            const list = document.getElementById('batch-list');
            list.innerHTML = batch.length ? "<h3>BATCH</h3>" : "";
            batch.forEach((t, i) => list.innerHTML += `<div class="batch-card"><div><strong>${t.rblx}</strong> - ${t.score}/30 (${t.status})</div><button class="t-btn active-red" style="width:auto" onclick="batch.splice(${i},1);renderBatch()">X</button></div>`);
            document.getElementById('publish-btn').style.display = batch.length ? 'block' : 'none';
        }

        function clearForm() { 
            ['t-rblx', 't-id', 't-notes', 'note-know', 'note-s1', 'note-s2', 'note-drive'].forEach(id => document.getElementById(id).value = ""); 
            scores = {}; 
            document.querySelectorAll('.t-btn').forEach(b => b.className = 't-btn'); 
            document.querySelectorAll('.conditional-box').forEach(b => b.style.display = 'none'); 
        }

        async function postAnn() {
            const time = document.getElementById('ann-time').value;
            if(!time) return alert("Date and Time are required!");
            const unix = Math.floor(new Date(time).getTime() / 1000);
            const body = { content: `<@&${CONFIG.ANNOUNCE_ROLE_ID}>`, embeds: [{ title: "Training!", color: 16711935, image: { url: CONFIG.IMG_ANN }, fields: [{ name: "Type", value: document.getElementById('ann-type').value }, { name: "Time", value: `<t:${unix}:F>` }, { name: "Location", value: document.getElementById('ann-loc').value }] }] };
            await fetch(CONFIG.WEBHOOK_ANN, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(body) });
            alert("Sent.");
        }

        async function postVoiceVerify() {
            const body = { content: `<@${document.getElementById('v-trainee-uid').value}>`, embeds: [{ title: "VOICE VERIFY", image: { url: CONFIG.IMG_VV }, fields: [{ name: "User", value: document.getElementById('v-trainee-name').value }, { name: "Age", value: document.getElementById('v-age').value }] }] };
            await fetch(CONFIG.WEBHOOK_RES, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(body) });
            alert("Sent.");
        }

        async function publish() {
            const hId = document.getElementById('h-id').value;
            const pings = `<@${hId}>` + batch.map(t => ` <@${t.id}>`).join("");
            
            const embeds = batch.map((t, idx) => {
                const fields = [
                    { name: "User", value: `${t.rblx} (<@${t.id}>)`, inline: true },
                    { name: "Score", value: `**${t.score}/30**`, inline: true }
                ];

                // Conditional field adding: Only add if text exists
                if (t.notes.knowledge) fields.push({ name: "Knowledge Feedback", value: t.notes.knowledge });
                if (t.notes.scene1) fields.push({ name: "Scene 1 Feedback", value: t.notes.scene1 });
                if (t.notes.scene2) fields.push({ name: "Scene 2 Feedback", value: t.notes.scene2 });
                if (t.notes.driving) fields.push({ name: "Driving Feedback", value: t.notes.driving });
                if (t.notes.overall) fields.push({ name: "Final Summary", value: t.notes.overall });

                return {
                    title: `TRAINING EVALUATION: ${t.status}`,
                    color: t.status === "PASS" ? 65280 : (t.status === "DISQUALIFIED" ? 0 : 16711680),
                    image: idx === batch.length - 1 ? { url: CONFIG.IMG_RES } : null,
                    fields: fields,
                    footer: { text: "HRBRP Training Unit" }
                };
            });

            await fetch(CONFIG.WEBHOOK_RES, { 
                method: 'POST', 
                headers: {'Content-Type': 'application/json'}, 
                body: JSON.stringify({ content: pings, embeds }) 
            });
            alert("Published."); batch = []; renderBatch();
        }
    </script>
</body>
</html>
